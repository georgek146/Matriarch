Matriarch.controller('DeployViewController', ['$scope','$location','Web3Service','MeDao','MiniMeToken','Matriarch','Congress','IpfsService',
function($scope, $location, Web3Service, MeDao, MiniMeToken, Matriarch, Congress, IpfsService){
    console.log('Loading Deploy View');
    
    $scope.clicked = false;
    
    $scope.mmtAddress = '';
    $scope.congressAddress = '';
    $scope.medaoAddress = '';
    $scope.mmtOwnerSet = '';
    $scope.congressOwnerSet = '';
    $scope.registered = '';
    
    $scope.currentAccount = Web3Service.getCurrentAccount();
    
    $scope.goto = function(url){
        console.log(url);
        $location.url(url);
    };
    
    $scope.isDeployed = Matriarch.getMeDaoAddress(Web3Service.getCurrentAccount());
    
    $scope.isDeployed.then(
    function(meDaoAddress){
        console.log(meDaoAddress);
        if(meDaoAddress !== '0x0000000000000000000000000000000000000000'){
            $scope.goto('medao'+$scope.currentAccount);
        } else {
            $scope.created = false;
        }
    }).catch(function(err){
        console.error(err);
    });
    
    $scope.advanced = false;
    
    $scope.minimetoken = {
        tokenFactory: '0x4250efffC0e1c1f83Aa1CfD489fbB45E0a7F5f70',
        parentToken: 0,
        parentSnapShotBlock: 0,
        tokenName: 'Example Token',
        decimals: 18,
        tokenSymbol: 'exm',
        transfersEnabled: true
    };
    
    $scope.congress = {
        curator: Web3Service.getCurrentAccount()
    };
    
    $scope.medao = {
        ceo: Web3Service.getCurrentAccount(),
        curator: Web3Service.getCurrentAccount(),
        vault: Web3Service.getCurrentAccount(),
        minimeToken: null,
        congress: null,
        maxSupply: 1000000 // 1 million tokens with 18 decimal places
    };
    
    $scope.$watch('minimetoken.decimals',function(){
        $scope.decimals = {};
        
        $scope.decimals = '';
        for(var i = 0; i < $scope.minimetoken.decimals; i++)
            $scope.decimals += '0';
    });
    
    $scope.registerMeDao = function(address){
        console.log(address);
            
        Matriarch.registerMeDao(address).then(
        function(txHash){
            console.log(txHash);
        }).catch(function(err){
            console.error(err);
        });
    };
    
    //Deploys a MiniMe Token contract to the Ethereum blockchain
    $scope.deployMMT = function(){
        $scope.clicked = true;
        $scope.mmtAddress = 'Deploying...';
        var mmt = {
            abi: '[{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_amount","type":"uint256"}],"name":"approve","outputs":[{"name":"success","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"creationBlock","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_to","type":"address"},{"name":"_amount","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"success","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_newController","type":"address"}],"name":"changeController","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"_owner","type":"address"},{"name":"_blockNumber","type":"uint256"}],"name":"balanceOfAt","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"version","outputs":[{"name":"","type":"string"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_cloneTokenName","type":"string"},{"name":"_cloneDecimalUnits","type":"uint8"},{"name":"_cloneTokenSymbol","type":"string"},{"name":"_snapshotBlock","type":"uint256"},{"name":"_transfersEnabled","type":"bool"}],"name":"createCloneToken","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"parentToken","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_owner","type":"address"},{"name":"_amount","type":"uint256"}],"name":"generateTokens","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"_blockNumber","type":"uint256"}],"name":"totalSupplyAt","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_amount","type":"uint256"}],"name":"transfer","outputs":[{"name":"success","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"transfersEnabled","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"parentSnapShotBlock","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_amount","type":"uint256"},{"name":"_extraData","type":"bytes"}],"name":"approveAndCall","outputs":[{"name":"success","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_owner","type":"address"},{"name":"_amount","type":"uint256"}],"name":"destroyTokens","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"_owner","type":"address"},{"name":"_spender","type":"address"}],"name":"allowance","outputs":[{"name":"remaining","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"tokenFactory","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_transfersEnabled","type":"bool"}],"name":"enableTransfers","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"controller","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"inputs":[{"name":"_tokenFactory","type":"address"},{"name":"_parentToken","type":"address"},{"name":"_parentSnapShotBlock","type":"uint256"},{"name":"_tokenName","type":"string"},{"name":"_decimalUnits","type":"uint8"},{"name":"_tokenSymbol","type":"string"},{"name":"_transfersEnabled","type":"bool"}],"payable":false,"type":"constructor"},{"payable":true,"type":"fallback"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_from","type":"address"},{"indexed":true,"name":"_to","type":"address"},{"indexed":false,"name":"_amount","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_cloneToken","type":"address"},{"indexed":false,"name":"_snapshotBlock","type":"uint256"}],"name":"NewCloneToken","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_owner","type":"address"},{"indexed":true,"name":"_spender","type":"address"},{"indexed":false,"name":"_amount","type":"uint256"}],"name":"Approval","type":"event"}]',
            bytecode: '6060604052604060405190810160405280600781526020017f4d4d545f302e31000000000000000000000000000000000000000000000000008152506004908051906020019062000052929190620001fc565b5034156200005c57fe5b60405162002aa438038062002aa4833981016040528080519060200190919080519060200190919080519060200190919080518201919060200180519060200190919080518201919060200180519060200190919050505b5b33600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b86600b60016101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550836001908051906020019062000150929190620001fc565b5082600260006101000a81548160ff021916908360ff160217905550816003908051906020019062000184929190620001fc565b5085600560006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508460068190555080600b60006101000a81548160ff021916908315150217905550436007819055505b50505050505050620002ab565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200023f57805160ff191683800117855562000270565b8280016001018555821562000270579182015b828111156200026f57825182559160200191906001019062000252565b5b5090506200027f919062000283565b5090565b620002a891905b80821115620002a45760008160009055506001016200028a565b5090565b90565b6127e980620002bb6000396000f3006060604052361561013c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806306fdde0314610265578063095ea7b3146102fe578063176345141461035557806318160ddd1461037b57806323b872dd146103a1578063313ce567146104175780633cebb823146104435780634ee2cd7e1461047957806354fd4d50146104cc5780636638c0871461056557806370a082311461066257806380a54001146106ac578063827f32c0146106fe57806395d89b4114610755578063981b24d0146107ee578063a9059cbb14610822578063bef97c8714610879578063c5bcc4f1146108a3578063cae9ca51146108c9578063d3ce77fe14610963578063dd62ed3e146109ba578063e77772fe14610a23578063f41e60c514610a75578063f77c479114610a97575b6102635b61016b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16610ae9565b1561025b57600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663f48c305434336000604051602001526040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019150506020604051808303818588803b151561023257fe5b61235a5a03f1151561024057fe5b5050505060405180519050151561025657610000565b610260565b610000565b5b565b005b341561026d57fe5b610275610b26565b60405180806020018281038252838181518152602001915080519060200190808383600083146102c4575b8051825260208311156102c4576020820191506020810190506020830392506102a0565b505050905090810190601f1680156102f05780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561030657fe5b61033b600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050610bc4565b604051808215151515815260200191505060405180910390f35b341561035d57fe5b610365610ebb565b6040518082815260200191505060405180910390f35b341561038357fe5b61038b610ec1565b6040518082815260200191505060405180910390f35b34156103a957fe5b6103fd600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050610ed2565b604051808215151515815260200191505060405180910390f35b341561041f57fe5b610427611073565b604051808260ff1660ff16815260200191505060405180910390f35b341561044b57fe5b610477600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050611086565b005b341561048157fe5b6104b6600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050611128565b6040518082815260200191505060405180910390f35b34156104d457fe5b6104dc6113b0565b604051808060200182810382528381815181526020019150805190602001908083836000831461052b575b80518252602083111561052b57602082019150602081019050602083039250610507565b505050905090810190601f1680156105575780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561056d57fe5b610620600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190803560ff1690602001909190803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091908035906020019091908035151590602001909190505061144e565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561066a57fe5b610696600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050611754565b6040518082815260200191505060405180910390f35b34156106b457fe5b6106bc611768565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561070657fe5b61073b600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803590602001909190505061178e565b604051808215151515815260200191505060405180910390f35b341561075d57fe5b6107656118bd565b60405180806020018281038252838181518152602001915080519060200190808383600083146107b4575b8051825260208311156107b457602082019150602081019050602083039250610790565b505050905090810190601f1680156107e05780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156107f657fe5b61080c600480803590602001909190505061195b565b6040518082815260200191505060405180910390f35b341561082a57fe5b61085f600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050611af7565b604051808215151515815260200191505060405180910390f35b341561088157fe5b610889611b28565b604051808215151515815260200191505060405180910390f35b34156108ab57fe5b6108b3611b3b565b6040518082815260200191505060405180910390f35b34156108d157fe5b610949600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803590602001909190803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091905050611b41565b604051808215151515815260200191505060405180910390f35b341561096b57fe5b6109a0600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050611df1565b604051808215151515815260200191505060405180910390f35b34156109c257fe5b610a0d600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050611f3a565b6040518082815260200191505060405180910390f35b3415610a2b57fe5b610a33611fc2565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b3415610a7d57fe5b610a9560048080351515906020019091905050611fe8565b005b3415610a9f57fe5b610aa7612063565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6000600060008373ffffffffffffffffffffffffffffffffffffffff161415610b155760009150610b20565b823b90506000811191505b50919050565b60018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610bbc5780601f10610b9157610100808354040283529160200191610bbc565b820191906000526020600020905b815481529060010190602001808311610b9f57829003601f168201915b505050505081565b6000600b60009054906101000a900460ff161515610be157610000565b60008214158015610c6f57506000600960003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205414155b15610c7957610000565b610ca4600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16610ae9565b15610dca57600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663da682aeb3385856000604051602001526040518463ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018281526020019350505050602060405180830381600087803b1515610da757fe5b60325a03f11515610db457fe5b505050604051805190501515610dc957610000565b5b81600960003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925846040518082815260200191505060405180910390a3600190505b92915050565b60075481565b6000610ecc4361195b565b90505b90565b6000600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561105e57600b60009054906101000a900460ff161515610f4657610000565b81600960008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541015610fd3576000905061106c565b81600960008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825403925050819055505b611069848484612089565b90505b9392505050565b600260009054906101000a900460ff1681565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415156110e257610000565b80600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b50565b600060075482101561113d57600090506113aa565b6000600860008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002080549050148061121a575081600860008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008154811015156111d757fe5b906000526020600020900160005b5060000160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16115b15611359576000600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614151561134b57600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16634ee2cd7e846006546000604051602001526040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200182815260200192505050602060405180830381600087803b151561132d57fe5b60325a03f1151561133a57fe5b5050506040518051905090506113aa565b600090506113aa565b6113a8565b6113a1600860008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208361237c565b90506113aa565b5b5b92915050565b60048054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156114465780601f1061141b57610100808354040283529160200191611446565b820191906000526020600020905b81548152906001019060200180831161142957829003601f168201915b505050505081565b600060004384111561145e574393505b600b60019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16635b7b72c130868a8a8a896000604051602001526040518763ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001868152602001806020018560ff1660ff1681526020018060200184151515158152602001838103835287818151815260200191508051906020019080838360008314611577575b80518252602083111561157757602082019150602081019050602083039250611553565b505050905090810190601f1680156115a35780820380516001836020036101000a031916815260200191505b508381038252858181518152602001915080519060200190808383600083146115eb575b8051825260208311156115eb576020820191506020810190506020830392506115c7565b505050905090810190601f1680156116175780820380516001836020036101000a031916815260200191505b5098505050505050505050602060405180830381600087803b151561163857fe5b60325a03f1151561164557fe5b5050506040518051905090508073ffffffffffffffffffffffffffffffffffffffff16633cebb823336040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050600060405180830381600087803b15156116e857fe5b60325a03f115156116f557fe5b5050508073ffffffffffffffffffffffffffffffffffffffff167f086c875b377f900b07ce03575813022f05dd10ed7640b5282cf6d3c3fc352ade856040518082815260200191505060405180910390a28091505b5095945050505050565b60006117608243611128565b90505b919050565b600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600060006000600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415156117f057610000565b6117fb600a4361237c565b915061180a600a8584016125a6565b61181385611754565b905061185f600860008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208583016125a6565b8473ffffffffffffffffffffffffffffffffffffffff1660007fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef866040518082815260200191505060405180910390a3600192505b5b505092915050565b60038054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119535780601f1061192857610100808354040283529160200191611953565b820191906000526020600020905b81548152906001019060200180831161193657829003601f168201915b505050505081565b60006007548210156119705760009050611af2565b6000600a8054905014806119d3575081600a600081548110151561199057fe5b906000526020600020900160005b5060000160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16115b15611ade576000600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16141515611ad057600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663981b24d06006546000604051602001526040518263ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180828152602001915050602060405180830381600087803b1515611ab257fe5b60325a03f11515611abf57fe5b505050604051805190509050611af2565b60009050611af2565b611af0565b611ae9600a8361237c565b9050611af2565b5b5b919050565b6000600b60009054906101000a900460ff161515611b1457610000565b611b1f338484612089565b90505b92915050565b600b60009054906101000a900460ff1681565b60065481565b600082600960003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508373ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925856040518082815260200191505060405180910390a38373ffffffffffffffffffffffffffffffffffffffff1660405180807f72656365697665417070726f76616c28616464726573732c75696e743235362c81526020017f616464726573732c627974657329000000000000000000000000000000000000815250602e01905060405180910390207c01000000000000000000000000000000000000000000000000000000009004338530866040518563ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018481526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001828051906020019080838360008314611d91575b805182526020831115611d9157602082019150602081019050602083039250611d6d565b505050905090810190601f168015611dbd5780820380516001836020036101000a031916815260200191505b509450505050506000604051808303816000876161da5a03f1925050501515611de557610000565b600190505b9392505050565b600060006000600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515611e5357610000565b611e5e600a4361237c565b915083821015611e6d57610000565b611e7a600a8584036125a6565b611e8385611754565b905083811015611e9257610000565b611edc600860008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208583036125a6565b60008573ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef866040518082815260200191505060405180910390a3600192505b5b505092915050565b6000600960008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205490505b92915050565b600b60019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561204457610000565b80600b60006101000a81548160ff0219169083151502179055505b5b50565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60006000600060008414156120a15760019250612373565b60008573ffffffffffffffffffffffffffffffffffffffff1614806120f157503073ffffffffffffffffffffffffffffffffffffffff168573ffffffffffffffffffffffffffffffffffffffff16145b156120fb57610000565b6121058643611128565b9150838210156121185760009250612373565b612143600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16610ae9565b1561226957600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16634a3931498787876000604051602001526040518463ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018281526020019350505050602060405180830381600087803b151561224657fe5b60325a03f1151561225357fe5b50505060405180519050151561226857610000565b5b6122b3600860008873ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208584036125a6565b6122bd8543611128565b9050612309600860008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208583016125a6565b8473ffffffffffffffffffffffffffffffffffffffff168673ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef866040518082815260200191505060405180910390a3600192505b50509392505050565b600060006000600060008680549050141561239a576000935061259d565b8560018780549050038154811015156123af57fe5b906000526020600020900160005b5060000160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16851015156124555785600187805490500381548110151561240d57fe5b906000526020600020900160005b5060000160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16935061259d565b85600081548110151561246457fe5b906000526020600020900160005b5060000160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff168510156124b5576000935061259d565b60009250600186805490500391505b8282111561254b5760026001848401018115156124dd57fe5b0490508486828154811015156124ef57fe5b906000526020600020900160005b5060000160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1611151561253f57809250612546565b6001810391505b6124c4565b858381548110151561255957fe5b906000526020600020900160005b5060000160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1693505b50505092915050565b600060006000848054905014806126115750438460018680549050038154811015156125ce57fe5b906000526020600020900160005b5060000160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16105b156126c2578384805480919060010161262a919061272b565b81548110151561263657fe5b906000526020600020900160005b509150438260000160006101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff160217905550828260000160106101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff160217905550612724565b8360018580549050038154811015156126d757fe5b906000526020600020900160005b509050828160000160106101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff1602179055505b5b50505050565b815481835581811511612752578183600052602060002091820191016127519190612757565b5b505050565b6127ba91905b808211156127b65760006000820160006101000a8154906fffffffffffffffffffffffffffffffff02191690556000820160106101000a8154906fffffffffffffffffffffffffffffffff02191690555060010161275d565b5090565b905600a165627a7a723058209b8021ed6f3d1bcdfdd841e23cc80189b6711c78dcf6e4ba84a124adc347de7e0029'
        }
        
        console.log($scope.minimetoken);
        var contract = web3.eth.contract(JSON.parse(mmt.abi));
        var contractInstance = contract.new(
        $scope.minimetoken.tokenFactory,
        $scope.minimetoken.parentToken,
        $scope.minimetoken.parentSnapShotBlock,
        $scope.minimetoken.tokenName,
        $scope.minimetoken.decimals,
        $scope.minimetoken.tokenSymbol,
        $scope.minimetoken.transfersEnabled,
        {
            from: web3.eth.accounts[0],
            data: mmt.bytecode
        }, 
        function (err, contract){
            console.log(contract);
            if (typeof(contract.address) !== 'undefined') {
                $scope.$apply(function(){
                    console.log('MMT Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
                    $scope.medao.minimeToken = contract.address;
                    $scope.mmtAddress = contract.address;
                    $scope.deployCongress();
                });
            } else {
                if(err)
                    console.error(err);
            }
        });
    };
    
    //Deploys a Congress contract to the Ethereum blockchain
    $scope.deployCongress = function(){
        var congress = {
            abi:'[{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"proposals","outputs":[{"name":"action","type":"bytes32"},{"name":"description_hash","type":"string"},{"name":"address_storage","type":"address"},{"name":"uint_storage","type":"uint256"},{"name":"passed","type":"bool"},{"name":"rejected","type":"bool"},{"name":"timestamp","type":"uint256"},{"name":"support","type":"uint256"},{"name":"against","type":"uint256"},{"name":"total_voters","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_voter","type":"address"},{"name":"_proposal_id","type":"uint256"}],"name":"unvote","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"_proposal_id","type":"uint256"}],"name":"getProposalAddress","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_action","type":"bytes32"},{"name":"_description_hash","type":"string"},{"name":"_relevant_address","type":"address"},{"name":"_relevant_amount","type":"uint256"}],"name":"submitProposal","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"_voter","type":"address"}],"name":"isVoterLocked","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_newController","type":"address"}],"name":"changeController","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"majority_percent","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"_proposal_id","type":"uint256"}],"name":"getProposalUint","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"_proposal_id","type":"uint256"}],"name":"getProposalAction","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"total_proposals","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"voters","outputs":[{"name":"timestamp","type":"uint256"},{"name":"locks","type":"uint256"},{"name":"locked_tokens","type":"uint256"},{"name":"total_votes","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"total_locked_tokens","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_proposal_id","type":"uint256"},{"name":"_support","type":"bool"}],"name":"vote","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_proposal_id","type":"uint256"}],"name":"pass","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"curator","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"total_voters","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"controller","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"inputs":[{"name":"_curator","type":"address"}],"payable":false,"type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_from","type":"address"},{"indexed":true,"name":"_to","type":"address"},{"indexed":false,"name":"_amount","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_cloneToken","type":"address"},{"indexed":false,"name":"_snapshotBlock","type":"uint256"}],"name":"NewCloneToken","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_owner","type":"address"},{"indexed":true,"name":"_spender","type":"address"},{"indexed":false,"name":"_amount","type":"uint256"}],"name":"Approval","type":"event"}]',
            bytecode:'6060604052624f1a00600255603360035560006005556000600755341561002257fe5b6040516020806119a9833981016040528080519060200190919050505b5b33600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b80600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b505b6118d4806100d56000396000f300606060405236156100ef576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063013cf08b146100f157806302aa9be2146102225780631128bbfd14610261578063116ded0f146102c157806324888b4a146103505780633cebb8231461039e5780634cf2bc1f146103d457806369de374d146103fa5780637da813641461042e57806385d7305e1461046a578063a3ec138d14610490578063ad3006c1146104ef578063c9d27afe14610515578063d67c996114610540578063e66f53b714610560578063e8677f19146105b2578063f77c4791146105d8575bfe5b34156100f957fe5b61010f600480803590602001909190505061062a565b604051808b60001916600019168152602001806020018a73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001898152602001881515151581526020018715151515815260200186815260200185815260200184815260200183815260200182810382528b81815460018160011615610100020316600290048152602001915080546001816001161561010002031660029004801561020a5780601f106101df5761010080835404028352916020019161020a565b820191906000526020600020905b8154815290600101906020018083116101ed57829003601f168201915b50509b50505050505050505050505060405180910390f35b341561022a57fe5b61025f600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919080359060200190919050506106b7565b005b341561026957fe5b61027f6004808035906020019091905050610b3e565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34156102c957fe5b61034e60048080356000191690602001909190803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050610b7f565b005b341561035857fe5b610384600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610d03565b604051808215151515815260200191505060405180910390f35b34156103a657fe5b6103d2600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610d53565b005b34156103dc57fe5b6103e4610df5565b6040518082815260200191505060405180910390f35b341561040257fe5b6104186004808035906020019091905050610dfb565b6040518082815260200191505060405180910390f35b341561043657fe5b61044c6004808035906020019091905050610e1c565b60405180826000191660001916815260200191505060405180910390f35b341561047257fe5b61047a610e3d565b6040518082815260200191505060405180910390f35b341561049857fe5b6104c4600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610e43565b6040518085815260200184815260200183815260200182815260200194505050505060405180910390f35b34156104f757fe5b6104ff610e73565b6040518082815260200191505060405180910390f35b341561051d57fe5b61053e60048080359060200190919080351515906020019091905050610e79565b005b341561054857fe5b61055e6004808035906020019091905050611595565b005b341561056857fe5b6105706117b1565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34156105ba57fe5b6105c26117d7565b6040518082815260200191505060405180910390f35b34156105e057fe5b6105e86117dd565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b600860205280600052604060002060009150905080600001549080600101908060020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16908060030154908060040160009054906101000a900460ff16908060040160019054906101000a900460ff1690806005015490806006015490806007015490806008015490508a565b80600754811015156106c857610000565b6008600082815260200190815260200160002060040160009054906101000a900460ff16156106f657610000565b6008600082815260200190815260200160002060040160019054906101000a900460ff161561072457610000565b3373ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff161415156107ad57600254600660008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000154420310156107ac57610000565b5b6000600660008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206001015414156107fd57610000565b600060086000848152602001908152602001600020600a0160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000154141561086157610000565b60086000838152602001908152602001600020600a0160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160009054906101000a900460ff16156109495760086000838152602001908152602001600020600a0160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000015460086000848152602001908152602001600020600601600082825403925050819055506109c4565b60086000838152602001908152602001600020600a0160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000015460086000848152602001908152602001600020600701600082825403925050819055505b600860008381526020019081526020016000206008016000815480929190600190039190505550600660008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160008154809291906001900391905055506000600660008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600101541415610b3757600660008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600201546004600082825403925050819055506000600660008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020181905550600560008154809291906001900391905055505b5b5b505050565b60006008600083815260200190815260200160002060020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690505b919050565b61014060405190810160405280856000191681526020018481526020018373ffffffffffffffffffffffffffffffffffffffff1681526020018281526020016000151581526020016000151581526020016000815260200160008152602001600081526020016000815250600860006007548152602001908152602001600020600082015181600001906000191690556020820151816001019080519060200190610c2b929190611803565b5060408201518160020160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506060820151816003015560808201518160040160006101000a81548160ff02191690831515021790555060a08201518160040160016101000a81548160ff02191690831515021790555060c0820151816005015560e08201518160060155610100820151816007015561012082015181600801559050506007600081548092919060010191905055505b50505050565b60006000600660008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600101541190505b919050565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515610daf57610000565b80600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b50565b60035481565b6000600860008381526020019081526020016000206003015490505b919050565b6000600860008381526020019081526020016000206000015490505b919050565b60075481565b60066020528060005260406000206000915090508060000154908060010154908060020154908060030154905084565b60045481565b600060006000600060008660075481101515610e9457610000565b6008600082815260200190815260200160002060040160009054906101000a900460ff1615610ec257610000565b6008600082815260200190815260200160002060040160019054906101000a900460ff1615610ef057610000565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663ac6c5251336000604051602001526040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b1515610fb257fe5b60325a03f11515610fbf57fe5b5050506040518051905095506000861415610fd957610000565b6000600660003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600101541415611037576005600081548092919060010191905055505b600660003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600201549450848603935060008411156110e2578360046000828254019250508190555085600660003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600201819055505b60086000898152602001908152602001600020600a0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000154925060086000898152602001908152602001600020600a0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160009054906101000a900460ff169150600083111561132e5786151582151514151561120c5781156111e65782600860008a81526020019081526020016000206006016000828254039250508190555061120b565b82600860008a8152602001908152602001600020600701600082825403925050819055505b5b85600860008a8152602001908152602001600020600a0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000018190555086600860008a8152602001908152602001600020600a0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160006101000a81548160ff02191690831515021790555086156113045785600860008a815260200190815260200160002060060160008282540192505081905550611329565b85600860008a8152602001908152602001600020600701600082825401925050819055505b611542565b87600660003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206004016000600660003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060030154815260200190815260200160002081905550600660003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060030160008154809291906001019190505550600860008981526020019081526020016000206008016000815480929190600101919050555085600860008a8152602001908152602001600020600a0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000018190555086156114ca5785600860008a8152602001908152602001600020600601600082825401925050819055506114ef565b85600860008a8152602001908152602001600020600701600082825401925050819055505b600660003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600101600081548092919060010191905055505b42600660003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600001819055505b5b5050505050505050565b6000600060006000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415156115f957610000565b600860008681526020019081526020016000206000015493507f6f6e676f696e67000000000000000000000000000000000000000000000000008460001916141561164357610000565b60646003546004540281151561165557fe5b04925060086000868152602001908152602001600020600601549150828211156116a95760016008600087815260200190815260200160002060040160006101000a81548160ff0219169083151502179055505b60086000868152602001908152602001600020600701549050828111156116fa5760016008600087815260200190815260200160002060040160016101000a81548160ff0219169083151502179055505b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16630a0155e5866000604051602001526040518263ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180828152602001915050602060405180830381600087803b151561179057fe5b60325a03f1151561179d57fe5b50505060405180519050505b5b5050505050565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60055481565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061184457805160ff1916838001178555611872565b82800160010185558215611872579182015b82811115611871578251825591602001919060010190611856565b5b50905061187f9190611883565b5090565b6118a591905b808211156118a1576000816000905550600101611889565b5090565b905600a165627a7a723058209efb57485c24458d196d5e054ec33d62abd86527be33002757e1b5f8ad390dd90029'
        }
        $scope.congressAddress = 'Deploying...';
        var contract = web3.eth.contract(JSON.parse(congress.abi));
        var contractInstance = contract.new(
        $scope.congress.curator,
        {
            from: web3.eth.accounts[0],
            data: congress.bytecode
        }, 
        function (err, contract){
            console.log(contract);
            if (typeof contract.address !== 'undefined') {
                console.log('Congress Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
                $scope.medao.congress = contract.address;
                $scope.congressAddress = contract.address;
                $scope.deployMeDao();
            } else {
                if(err)
                    console.error(err);
            }
        });
    };
    
    //Deploys a MeDao contract to the Ethereum blockchain
    $scope.deployMeDao = function(){
        var medao = {
            abi:'[{"constant":false,"inputs":[{"name":"_proposal_id","type":"uint256"}],"name":"passed","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"toggleTransfers","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_to","type":"address"},{"name":"_amount","type":"uint256"}],"name":"onTransfer","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"newAddress","type":"address"}],"name":"easyUpdateMatriarch","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"TRANSFERS_ALLOWED","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"congress","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"ceo","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"tokens","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_voter","type":"address"}],"name":"getWeight","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"Version","outputs":[{"name":"","type":"string"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_owner","type":"address"},{"name":"_spender","type":"address"},{"name":"_amount","type":"uint256"}],"name":"onApprove","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"MAX_PURCHASABLE_TOKEN_SUPPLY","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"curator","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"PURCHASABLE_TOKEN_SUPPLY_CAPPED","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_owner","type":"address"}],"name":"proxyPayment","outputs":[{"name":"","type":"bool"}],"payable":true,"type":"function"},{"constant":true,"inputs":[],"name":"vault","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"PURCHASED_TOKEN_SUPPLY","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"inputs":[{"name":"_ceo","type":"address"},{"name":"_curator","type":"address"},{"name":"_vault","type":"address"},{"name":"_MiniMeToken","type":"address"},{"name":"_Congress","type":"address"},{"name":"_MAX_PURCHASABLE_TOKEN_SUPPLY","type":"uint256"}],"payable":false,"type":"constructor"},{"payable":true,"type":"fallback"},{"anonymous":false,"inputs":[{"indexed":false,"name":"newController","type":"address"}],"name":"NewController_event","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"newCongress","type":"address"}],"name":"NewCongress_event","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"allowed","type":"bool"}],"name":"TransfersToggled_event","type":"event"}]',
            bytecode:'6060604052604060405190810160405280600f81526020017f4d61747269617263685f302e302e35000000000000000000000000000000000081525060009080519060200190620000529291906200026c565b506000600860006101000a81548160ff0219169083151502179055506001600860016101000a81548160ff02191690831515021790555034156200009257fe5b60405160c08062001877833981016040528080519060200190919080519060200190919080519060200190919080519060200190919080519060200190919080519060200190919050505b85600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555084600360006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555083600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555082600460006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555081600560006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550806006819055506000600860006101000a81548160ff0219169083151502179055506001600860016101000a81548160ff0219169083151502179055505b5050505050506200031b565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10620002af57805160ff1916838001178555620002e0565b82800160010185558215620002e0579182015b82811115620002df578251825591602001919060010190620002c2565b5b509050620002ef9190620002f3565b5090565b6200031891905b8082111562000314576000816000905550600101620002fa565b5090565b90565b61154c806200032b6000396000f300606060405236156100ef576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680630a0155e51461010c5780633e5ac28f146101445780634a3931491461015657806360785bd1146101cc57806375a75ba91461020257806386b0befc1461022c578063908921fc1461027e5780639d63848a146102d0578063ac6c525114610322578063bb62860d1461036c578063da682aeb14610405578063de327b961461047b578063e66f53b7146104a1578063f2123276146104f3578063f48c30541461051d578063fbfa77cf14610563578063ff22f90b146105b5575b61010a5b6100fc336105db565b151561010757610000565b5b565b005b341561011457fe5b61012a60048080359060200190919050506107fe565b604051808215151515815260200191505060405180910390f35b341561014c57fe5b610154610d98565b005b341561015e57fe5b6101b2600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050610f1c565b604051808215151515815260200191505060405180910390f35b34156101d457fe5b610200600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190505061101f565b005b341561020a57fe5b6102126111ac565b604051808215151515815260200191505060405180910390f35b341561023457fe5b61023c6111bf565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561028657fe5b61028e6111e5565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34156102d857fe5b6102e061120b565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561032a57fe5b610356600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050611231565b6040518082815260200191505060405180910390f35b341561037457fe5b61037c611314565b60405180806020018281038252838181518152602001915080519060200190808383600083146103cb575b8051825260208311156103cb576020820191506020810190506020830392506103a7565b505050905090810190601f1680156103f75780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561040d57fe5b610461600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803573ffffffffffffffffffffffffffffffffffffffff169060200190919080359060200190919050506113b2565b604051808215151515815260200191505060405180910390f35b341561048357fe5b61048b6114b5565b6040518082815260200191505060405180910390f35b34156104a957fe5b6104b16114bb565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34156104fb57fe5b6105036114e1565b604051808215151515815260200191505060405180910390f35b610549600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919050506105db565b604051808215151515815260200191505060405180910390f35b341561056b57fe5b6105736114f4565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34156105bd57fe5b6105c561151a565b6040518082815260200191505060405180910390f35b6000600060006000600860009054906101000a900460ff161561060157600093506107f6565b60065460075410151561061757600093506107f6565b600754600654039250349150828211156106965782820390503373ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051809050600060405180830381858888f19350505050151561067757600093506107f6565b8291506001600860006101000a81548160ff0219169083151502179055505b81600760008282540192505081905550600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663827f32c086846000604051602001526040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200182815260200192505050602060405180830381600087803b151561077057fe5b60325a03f1151561077d57fe5b5050506040518051905050600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc839081150290604051809050600060405180830381858888f1935050505015156107f157600093506107f6565b600193505b505050919050565b60006000600060006000600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561086457610000565b600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16637da81364876000604051602001526040518263ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180828152602001915050602060405180830381600087803b15156108fa57fe5b60325a03f1151561090757fe5b5050506040518051905093507f7570646174654d6174726961726368000000000000000000000000000000000084600019161415610b1f57600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16631128bbfd876000604051602001526040518263ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180828152602001915050602060405180830381600087803b15156109d557fe5b60325a03f115156109e257fe5b505050604051805190509250600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16633cebb823846040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050600060405180830381600087803b1515610aa757fe5b60325a03f11515610ab457fe5b5050507f258e1361e1ab824fce3351f14438a664d7997012f7e5cdba40c3799cb828fd3a83604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390a1610d8d565b7f67656e6572617465546f6b656e7300000000000000000000000000000000000084600019161415610d8c57600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16631128bbfd876000604051602001526040518263ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180828152602001915050602060405180830381600087803b1515610be157fe5b60325a03f11515610bee57fe5b505050604051805190509150600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166369de374d876000604051602001526040518263ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180828152602001915050602060405180830381600087803b1515610c9057fe5b60325a03f11515610c9d57fe5b505050604051805190509050600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663827f32c083836000604051602001526040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200182815260200192505050602060405180830381600087803b1515610d7357fe5b60325a03f11515610d8057fe5b50505060405180519050505b5b5b5b50505050919050565b600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515610df457610000565b600860019054906101000a900460ff1615600860016101000a81548160ff021916908315150217905550600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663f41e60c5600860019054906101000a900460ff166040518263ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004018082151515158152602001915050600060405180830381600087803b1515610ebe57fe5b60325a03f11515610ecb57fe5b5050507fc9da7d40863c4f6aba32e56f54c5ba7b08430ee07931d78849fa01cd06a164ce600860019054906101000a900460ff16604051808215151515815260200191505060405180910390a15b5b565b60006000600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166324888b4a866000604051602001526040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b1515610fe257fe5b60325a03f11515610fef57fe5b505050604051805190509050600860019054906101000a900460ff1680156110145750805b91505b509392505050565b600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561107b57610000565b600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16633cebb823826040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050600060405180830381600087803b151561113457fe5b60325a03f1151561114157fe5b5050507f258e1361e1ab824fce3351f14438a664d7997012f7e5cdba40c3799cb828fd3a81604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390a15b5b50565b600860019054906101000a900460ff1681565b600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166370a08231836000604051602001526040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b15156112f557fe5b60325a03f1151561130257fe5b5050506040518051905090505b919050565b60008054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156113aa5780601f1061137f576101008083540402835291602001916113aa565b820191906000526020600020905b81548152906001019060200180831161138d57829003601f168201915b505050505081565b60006000600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166324888b4a866000604051602001526040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b151561147857fe5b60325a03f1151561148557fe5b505050604051805190509050600860019054906101000a900460ff1680156114aa5750805b91505b509392505050565b60065481565b600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600860009054906101000a900460ff1681565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600754815600a165627a7a723058208c1f38622a746b386c5e8015ae311b4671d5551a57788d2e1b969c732443b3d40029'
        }
        console.log('Deploying MeDao', $scope.medao);
        $scope.medaoAddress = 'Deploying';
        
        for(var i = 0; i < $scope.minimetoken.decimals; i++)
            $scope.medao.maxSupply *= 10;
        
        console.log($scope.medao.maxSupply);
        
        var contract = web3.eth.contract(JSON.parse(medao.abi));
        var contractInstance = contract.new(
        $scope.medao.ceo,
        $scope.medao.curator,
        $scope.medao.vault,
        $scope.medao.minimeToken,
        $scope.medao.congress,
        $scope.medao.maxSupply,
        {
            from: web3.eth.accounts[0],
            data: medao.bytecode
        }, 
        function (err, contract){
            console.log(contract);
            if (typeof contract.address !== 'undefined') {
                console.log('MeDao Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
                
                $scope.medaoAddress = contract.address;
                
                MiniMeToken.setMMTAddress($scope.medao.minimeToken);
                Congress.setCongressAddress($scope.medao.congress);
                
                MiniMeToken.changeController(contract.address).then(
                function(txHash){
                    console.log('Set MMT Controller txHash:',txHash);
                    $scope.mmtOwnerSet = 'Setting...';
                    return Web3Service.getTransactionReceipt(txHash);
                }).then(function(included){
                    if(included)
                        $scope.mmtOwnerSet = 'success';
                    else
                        $scope.mmtOwnerSet = 'failed';
                    
                    return Congress.changeController(contract.address);
                }).then(function(txHash){
                    console.log('Set Congress Controller txHash:',txHash);
                    $scope.congressOwnerSet = 'Setting...';
                    return Web3Service.getTransactionReceipt(txHash);
                }).then(function(included){
                    if(included)
                        $scope.congressOwnerSet = 'success';
                    else
                        $scope.congressOwnerSet = 'failed';
                    
                    return Matriarch.registerMeDao(contract.address);
                }).then(function(txHash){
                    console.log('Me Dao Register txHash:',txHash);
                    $scope.registered = 'Registering...';
                    return Web3Service.getTransactionReceipt(txHash);
                }).then(function(included){
                    if(included)
                        $scope.registered = 'success';
                    else
                        $scope.registered = 'failed';
                    
                    $scope.goto('medao/' + $scope.currentAccount);
                    
                }).catch(function(err){
                    console.error(err);
                });
            } else {
                if(err)
                    console.error(err);
            }
        });
    };
    
}]);