Matriarch.controller('MeDaoViewController', ['$scope','Web3Service','MeDao','MiniMeToken','Matriarch','Congress',
function($scope, Web3Service, MeDao, MiniMeToken, Matriarch, Congress){
    console.log('Loading MeDao View');
    
    $scope.created = true;
    $scope.hidden = true;
    
    Matriarch.getMeDao(Web3Service.getCurrentAccount()).then(
    function(meDaoAddress){
        console.log(meDaoAddress);
        if(meDaoAddress !== '0x0000000000000000000000000000000000000000'){
            MeDao.setMeDaoAddress(meDaoAddress);
            MeDao.getMMTAddress().then(
            function(mmtAddress){
                console.log(mmtAddress);
                MiniMeToken.setMMTAddress(mmtAddress);
                setup();
                $scope.hidden = false;
                return MeDao.getCongressAddress();
            }).then(function(congressAddress){
                Congress.setCongressAddress(congressAddress);
            }).catch(function(err){
                console.error(err);
            });
        } else {
            $scope.created = false;
        }
    }).catch(function(err){
        console.error(err);
    });
    
    $scope.minimetoken = {
        tokenFactory: '0x4250efffC0e1c1f83Aa1CfD489fbB45E0a7F5f70',
        parentToken: 0,
        parentSnapShotBlock: 0,
        tokenName: null,
        decimals: 18,
        tokenSymbol: null,
        transfersEnabled: true
    };
    
    $scope.congress = {
        curator: Web3Service.getCurrentAccount()
    };
    
    $scope.medao = {
        ceo: Web3Service.getCurrentAccount(),
        curator: Web3Service.getCurrentAccount(),
        vault: Web3Service.getCurrentAccount(),
        minimeToken: null,
        congress: null,
        maxTokenSupply: 1000000
    };
    
    $scope.registerMeDao = function(address){
        console.log(address);
            
        Matriarch.registerMeDao(address).then(
        function(txHash){
            console.log(txHash);
        }).catch(function(err){
            console.error(err);
        });
    };
    
    //Deploys a MiniMe Token contract to the Ethereum blockchain
    $scope.deployMMT = function(){
        var mmt = {
            abi: '[{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_amount","type":"uint256"}],"name":"approve","outputs":[{"name":"success","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"creationBlock","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_to","type":"address"},{"name":"_amount","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"success","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_newController","type":"address"}],"name":"changeController","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"_owner","type":"address"},{"name":"_blockNumber","type":"uint256"}],"name":"balanceOfAt","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"version","outputs":[{"name":"","type":"string"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_cloneTokenName","type":"string"},{"name":"_cloneDecimalUnits","type":"uint8"},{"name":"_cloneTokenSymbol","type":"string"},{"name":"_snapshotBlock","type":"uint256"},{"name":"_transfersEnabled","type":"bool"}],"name":"createCloneToken","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"parentToken","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_owner","type":"address"},{"name":"_amount","type":"uint256"}],"name":"generateTokens","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"_blockNumber","type":"uint256"}],"name":"totalSupplyAt","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_amount","type":"uint256"}],"name":"transfer","outputs":[{"name":"success","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"transfersEnabled","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"parentSnapShotBlock","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_amount","type":"uint256"},{"name":"_extraData","type":"bytes"}],"name":"approveAndCall","outputs":[{"name":"success","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_owner","type":"address"},{"name":"_amount","type":"uint256"}],"name":"destroyTokens","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"_owner","type":"address"},{"name":"_spender","type":"address"}],"name":"allowance","outputs":[{"name":"remaining","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"tokenFactory","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_transfersEnabled","type":"bool"}],"name":"enableTransfers","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"controller","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"inputs":[{"name":"_tokenFactory","type":"address"},{"name":"_parentToken","type":"address"},{"name":"_parentSnapShotBlock","type":"uint256"},{"name":"_tokenName","type":"string"},{"name":"_decimalUnits","type":"uint8"},{"name":"_tokenSymbol","type":"string"},{"name":"_transfersEnabled","type":"bool"}],"payable":false,"type":"constructor"},{"payable":true,"type":"fallback"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_from","type":"address"},{"indexed":true,"name":"_to","type":"address"},{"indexed":false,"name":"_amount","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_cloneToken","type":"address"},{"indexed":false,"name":"_snapshotBlock","type":"uint256"}],"name":"NewCloneToken","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_owner","type":"address"},{"indexed":true,"name":"_spender","type":"address"},{"indexed":false,"name":"_amount","type":"uint256"}],"name":"Approval","type":"event"}]',
            bytecode: '6060604052604060405190810160405280600781526020017f4d4d545f302e31000000000000000000000000000000000000000000000000008152506004908051906020019062000052929190620001fc565b5034156200005c57fe5b60405162002aa438038062002aa4833981016040528080519060200190919080519060200190919080519060200190919080518201919060200180519060200190919080518201919060200180519060200190919050505b5b33600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b86600b60016101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550836001908051906020019062000150929190620001fc565b5082600260006101000a81548160ff021916908360ff160217905550816003908051906020019062000184929190620001fc565b5085600560006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508460068190555080600b60006101000a81548160ff021916908315150217905550436007819055505b50505050505050620002ab565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200023f57805160ff191683800117855562000270565b8280016001018555821562000270579182015b828111156200026f57825182559160200191906001019062000252565b5b5090506200027f919062000283565b5090565b620002a891905b80821115620002a45760008160009055506001016200028a565b5090565b90565b6127e980620002bb6000396000f3006060604052361561013c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806306fdde0314610265578063095ea7b3146102fe578063176345141461035557806318160ddd1461037b57806323b872dd146103a1578063313ce567146104175780633cebb823146104435780634ee2cd7e1461047957806354fd4d50146104cc5780636638c0871461056557806370a082311461066257806380a54001146106ac578063827f32c0146106fe57806395d89b4114610755578063981b24d0146107ee578063a9059cbb14610822578063bef97c8714610879578063c5bcc4f1146108a3578063cae9ca51146108c9578063d3ce77fe14610963578063dd62ed3e146109ba578063e77772fe14610a23578063f41e60c514610a75578063f77c479114610a97575b6102635b61016b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16610ae9565b1561025b57600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663f48c305434336000604051602001526040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019150506020604051808303818588803b151561023257fe5b61235a5a03f1151561024057fe5b5050505060405180519050151561025657610000565b610260565b610000565b5b565b005b341561026d57fe5b610275610b26565b60405180806020018281038252838181518152602001915080519060200190808383600083146102c4575b8051825260208311156102c4576020820191506020810190506020830392506102a0565b505050905090810190601f1680156102f05780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561030657fe5b61033b600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050610bc4565b604051808215151515815260200191505060405180910390f35b341561035d57fe5b610365610ebb565b6040518082815260200191505060405180910390f35b341561038357fe5b61038b610ec1565b6040518082815260200191505060405180910390f35b34156103a957fe5b6103fd600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050610ed2565b604051808215151515815260200191505060405180910390f35b341561041f57fe5b610427611073565b604051808260ff1660ff16815260200191505060405180910390f35b341561044b57fe5b610477600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050611086565b005b341561048157fe5b6104b6600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050611128565b6040518082815260200191505060405180910390f35b34156104d457fe5b6104dc6113b0565b604051808060200182810382528381815181526020019150805190602001908083836000831461052b575b80518252602083111561052b57602082019150602081019050602083039250610507565b505050905090810190601f1680156105575780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561056d57fe5b610620600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190803560ff1690602001909190803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091908035906020019091908035151590602001909190505061144e565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561066a57fe5b610696600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050611754565b6040518082815260200191505060405180910390f35b34156106b457fe5b6106bc611768565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561070657fe5b61073b600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803590602001909190505061178e565b604051808215151515815260200191505060405180910390f35b341561075d57fe5b6107656118bd565b60405180806020018281038252838181518152602001915080519060200190808383600083146107b4575b8051825260208311156107b457602082019150602081019050602083039250610790565b505050905090810190601f1680156107e05780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156107f657fe5b61080c600480803590602001909190505061195b565b6040518082815260200191505060405180910390f35b341561082a57fe5b61085f600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050611af7565b604051808215151515815260200191505060405180910390f35b341561088157fe5b610889611b28565b604051808215151515815260200191505060405180910390f35b34156108ab57fe5b6108b3611b3b565b6040518082815260200191505060405180910390f35b34156108d157fe5b610949600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803590602001909190803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091905050611b41565b604051808215151515815260200191505060405180910390f35b341561096b57fe5b6109a0600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050611df1565b604051808215151515815260200191505060405180910390f35b34156109c257fe5b610a0d600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050611f3a565b6040518082815260200191505060405180910390f35b3415610a2b57fe5b610a33611fc2565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b3415610a7d57fe5b610a9560048080351515906020019091905050611fe8565b005b3415610a9f57fe5b610aa7612063565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6000600060008373ffffffffffffffffffffffffffffffffffffffff161415610b155760009150610b20565b823b90506000811191505b50919050565b60018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610bbc5780601f10610b9157610100808354040283529160200191610bbc565b820191906000526020600020905b815481529060010190602001808311610b9f57829003601f168201915b505050505081565b6000600b60009054906101000a900460ff161515610be157610000565b60008214158015610c6f57506000600960003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205414155b15610c7957610000565b610ca4600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16610ae9565b15610dca57600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663da682aeb3385856000604051602001526040518463ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018281526020019350505050602060405180830381600087803b1515610da757fe5b60325a03f11515610db457fe5b505050604051805190501515610dc957610000565b5b81600960003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925846040518082815260200191505060405180910390a3600190505b92915050565b60075481565b6000610ecc4361195b565b90505b90565b6000600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561105e57600b60009054906101000a900460ff161515610f4657610000565b81600960008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541015610fd3576000905061106c565b81600960008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825403925050819055505b611069848484612089565b90505b9392505050565b600260009054906101000a900460ff1681565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415156110e257610000565b80600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b50565b600060075482101561113d57600090506113aa565b6000600860008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002080549050148061121a575081600860008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008154811015156111d757fe5b906000526020600020900160005b5060000160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16115b15611359576000600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614151561134b57600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16634ee2cd7e846006546000604051602001526040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200182815260200192505050602060405180830381600087803b151561132d57fe5b60325a03f1151561133a57fe5b5050506040518051905090506113aa565b600090506113aa565b6113a8565b6113a1600860008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208361237c565b90506113aa565b5b5b92915050565b60048054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156114465780601f1061141b57610100808354040283529160200191611446565b820191906000526020600020905b81548152906001019060200180831161142957829003601f168201915b505050505081565b600060004384111561145e574393505b600b60019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16635b7b72c130868a8a8a896000604051602001526040518763ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001868152602001806020018560ff1660ff1681526020018060200184151515158152602001838103835287818151815260200191508051906020019080838360008314611577575b80518252602083111561157757602082019150602081019050602083039250611553565b505050905090810190601f1680156115a35780820380516001836020036101000a031916815260200191505b508381038252858181518152602001915080519060200190808383600083146115eb575b8051825260208311156115eb576020820191506020810190506020830392506115c7565b505050905090810190601f1680156116175780820380516001836020036101000a031916815260200191505b5098505050505050505050602060405180830381600087803b151561163857fe5b60325a03f1151561164557fe5b5050506040518051905090508073ffffffffffffffffffffffffffffffffffffffff16633cebb823336040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050600060405180830381600087803b15156116e857fe5b60325a03f115156116f557fe5b5050508073ffffffffffffffffffffffffffffffffffffffff167f086c875b377f900b07ce03575813022f05dd10ed7640b5282cf6d3c3fc352ade856040518082815260200191505060405180910390a28091505b5095945050505050565b60006117608243611128565b90505b919050565b600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600060006000600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415156117f057610000565b6117fb600a4361237c565b915061180a600a8584016125a6565b61181385611754565b905061185f600860008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208583016125a6565b8473ffffffffffffffffffffffffffffffffffffffff1660007fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef866040518082815260200191505060405180910390a3600192505b5b505092915050565b60038054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119535780601f1061192857610100808354040283529160200191611953565b820191906000526020600020905b81548152906001019060200180831161193657829003601f168201915b505050505081565b60006007548210156119705760009050611af2565b6000600a8054905014806119d3575081600a600081548110151561199057fe5b906000526020600020900160005b5060000160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16115b15611ade576000600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16141515611ad057600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663981b24d06006546000604051602001526040518263ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180828152602001915050602060405180830381600087803b1515611ab257fe5b60325a03f11515611abf57fe5b505050604051805190509050611af2565b60009050611af2565b611af0565b611ae9600a8361237c565b9050611af2565b5b5b919050565b6000600b60009054906101000a900460ff161515611b1457610000565b611b1f338484612089565b90505b92915050565b600b60009054906101000a900460ff1681565b60065481565b600082600960003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508373ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925856040518082815260200191505060405180910390a38373ffffffffffffffffffffffffffffffffffffffff1660405180807f72656365697665417070726f76616c28616464726573732c75696e743235362c81526020017f616464726573732c627974657329000000000000000000000000000000000000815250602e01905060405180910390207c01000000000000000000000000000000000000000000000000000000009004338530866040518563ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018481526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001828051906020019080838360008314611d91575b805182526020831115611d9157602082019150602081019050602083039250611d6d565b505050905090810190601f168015611dbd5780820380516001836020036101000a031916815260200191505b509450505050506000604051808303816000876161da5a03f1925050501515611de557610000565b600190505b9392505050565b600060006000600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515611e5357610000565b611e5e600a4361237c565b915083821015611e6d57610000565b611e7a600a8584036125a6565b611e8385611754565b905083811015611e9257610000565b611edc600860008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208583036125a6565b60008573ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef866040518082815260200191505060405180910390a3600192505b5b505092915050565b6000600960008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205490505b92915050565b600b60019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561204457610000565b80600b60006101000a81548160ff0219169083151502179055505b5b50565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60006000600060008414156120a15760019250612373565b60008573ffffffffffffffffffffffffffffffffffffffff1614806120f157503073ffffffffffffffffffffffffffffffffffffffff168573ffffffffffffffffffffffffffffffffffffffff16145b156120fb57610000565b6121058643611128565b9150838210156121185760009250612373565b612143600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16610ae9565b1561226957600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16634a3931498787876000604051602001526040518463ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018281526020019350505050602060405180830381600087803b151561224657fe5b60325a03f1151561225357fe5b50505060405180519050151561226857610000565b5b6122b3600860008873ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208584036125a6565b6122bd8543611128565b9050612309600860008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208583016125a6565b8473ffffffffffffffffffffffffffffffffffffffff168673ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef866040518082815260200191505060405180910390a3600192505b50509392505050565b600060006000600060008680549050141561239a576000935061259d565b8560018780549050038154811015156123af57fe5b906000526020600020900160005b5060000160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16851015156124555785600187805490500381548110151561240d57fe5b906000526020600020900160005b5060000160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16935061259d565b85600081548110151561246457fe5b906000526020600020900160005b5060000160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff168510156124b5576000935061259d565b60009250600186805490500391505b8282111561254b5760026001848401018115156124dd57fe5b0490508486828154811015156124ef57fe5b906000526020600020900160005b5060000160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1611151561253f57809250612546565b6001810391505b6124c4565b858381548110151561255957fe5b906000526020600020900160005b5060000160109054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1693505b50505092915050565b600060006000848054905014806126115750438460018680549050038154811015156125ce57fe5b906000526020600020900160005b5060000160009054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16105b156126c2578384805480919060010161262a919061272b565b81548110151561263657fe5b906000526020600020900160005b509150438260000160006101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff160217905550828260000160106101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff160217905550612724565b8360018580549050038154811015156126d757fe5b906000526020600020900160005b509050828160000160106101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff1602179055505b5b50505050565b815481835581811511612752578183600052602060002091820191016127519190612757565b5b505050565b6127ba91905b808211156127b65760006000820160006101000a8154906fffffffffffffffffffffffffffffffff02191690556000820160106101000a8154906fffffffffffffffffffffffffffffffff02191690555060010161275d565b5090565b905600a165627a7a723058209b8021ed6f3d1bcdfdd841e23cc80189b6711c78dcf6e4ba84a124adc347de7e0029'
        }
        
        console.log($scope.minimetoken);
        var contract = web3.eth.contract(JSON.parse(mmt.abi));
        var contractInstance = contract.new(
        $scope.minimetoken.tokenFactory,
        $scope.minimetoken.parentToken,
        $scope.minimetoken.parentSnapShotBlock,
        $scope.minimetoken.tokenName,
        $scope.minimetoken.decimals,
        $scope.minimetoken.tokenSymbol,
        $scope.minimetoken.transfersEnabled,
        {
            from: web3.eth.accounts[0],
            data: mmt.bytecode
        }, 
        function (err, contract){
            console.log(contract);
            if (typeof contract.address !== 'undefined') {
                $scope.$apply(function(){
                    console.log('MMT Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
                    $scope.medao.minimeToken = contract.address;
                    
                    $scope.deployCongress();
                });
            } else {
                if(err)
                    console.error(err);
            }
        });
    };
    
    //Deploys a Congress contract to the Ethereum blockchain
    $scope.deployCongress = function(){
        var congress = {
            abi:'[{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"proposals","outputs":[{"name":"action","type":"bytes32"},{"name":"description_hash","type":"string"},{"name":"address_storage","type":"address"},{"name":"uint_storage","type":"uint256"},{"name":"passed","type":"bool"},{"name":"rejected","type":"bool"},{"name":"timestamp","type":"uint256"},{"name":"support","type":"uint256"},{"name":"against","type":"uint256"},{"name":"total_voters","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_voter","type":"address"},{"name":"_proposal_id","type":"uint256"}],"name":"unvote","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"_proposal_id","type":"uint256"}],"name":"getProposalAddress","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_action","type":"bytes32"},{"name":"_description_hash","type":"string"},{"name":"_relevant_address","type":"address"},{"name":"_relevant_amount","type":"uint256"}],"name":"submitProposal","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"_voter","type":"address"}],"name":"isVoterLocked","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_newController","type":"address"}],"name":"changeController","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"majority_percent","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"_proposal_id","type":"uint256"}],"name":"getProposalUint","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"_proposal_id","type":"uint256"}],"name":"getProposalAction","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"total_proposals","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"voters","outputs":[{"name":"timestamp","type":"uint256"},{"name":"locks","type":"uint256"},{"name":"locked_tokens","type":"uint256"},{"name":"total_votes","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"total_locked_tokens","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_proposal_id","type":"uint256"},{"name":"_support","type":"bool"}],"name":"vote","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_proposal_id","type":"uint256"}],"name":"pass","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"total_voters","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"controller","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"inputs":[{"name":"_curator","type":"address"}],"payable":false,"type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_from","type":"address"},{"indexed":true,"name":"_to","type":"address"},{"indexed":false,"name":"_amount","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_cloneToken","type":"address"},{"indexed":false,"name":"_snapshotBlock","type":"uint256"}],"name":"NewCloneToken","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_owner","type":"address"},{"indexed":true,"name":"_spender","type":"address"},{"indexed":false,"name":"_amount","type":"uint256"}],"name":"Approval","type":"event"}]',
            bytecode:'6060604052624f1a00600255603360035560006005556000600755341561002257fe5b604051602080611926833981016040528080519060200190919050505b5b33600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b80600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b505b611851806100d56000396000f300606060405236156100e4576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063013cf08b146100e657806302aa9be2146102175780631128bbfd14610256578063116ded0f146102b657806324888b4a146103455780633cebb823146103935780634cf2bc1f146103c957806369de374d146103ef5780637da813641461042357806385d7305e1461045f578063a3ec138d14610485578063ad3006c1146104e4578063c9d27afe1461050a578063d67c996114610535578063e8677f1914610555578063f77c47911461057b575bfe5b34156100ee57fe5b61010460048080359060200190919050506105cd565b604051808b60001916600019168152602001806020018a73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001898152602001881515151581526020018715151515815260200186815260200185815260200184815260200183815260200182810382528b8181546001816001161561010002031660029004815260200191508054600181600116156101000203166002900480156101ff5780601f106101d4576101008083540402835291602001916101ff565b820191906000526020600020905b8154815290600101906020018083116101e257829003601f168201915b50509b50505050505050505050505060405180910390f35b341561021f57fe5b610254600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803590602001909190505061065a565b005b341561025e57fe5b6102746004808035906020019091905050610ae1565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34156102be57fe5b61034360048080356000191690602001909190803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050610b22565b005b341561034d57fe5b610379600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610ca6565b604051808215151515815260200191505060405180910390f35b341561039b57fe5b6103c7600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610cf6565b005b34156103d157fe5b6103d9610d98565b6040518082815260200191505060405180910390f35b34156103f757fe5b61040d6004808035906020019091905050610d9e565b6040518082815260200191505060405180910390f35b341561042b57fe5b6104416004808035906020019091905050610dbf565b60405180826000191660001916815260200191505060405180910390f35b341561046757fe5b61046f610de0565b6040518082815260200191505060405180910390f35b341561048d57fe5b6104b9600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610de6565b6040518085815260200184815260200183815260200182815260200194505050505060405180910390f35b34156104ec57fe5b6104f4610e16565b6040518082815260200191505060405180910390f35b341561051257fe5b61053360048080359060200190919080351515906020019091905050610e1c565b005b341561053d57fe5b6105536004808035906020019091905050611538565b005b341561055d57fe5b610565611754565b6040518082815260200191505060405180910390f35b341561058357fe5b61058b61175a565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b600860205280600052604060002060009150905080600001549080600101908060020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16908060030154908060040160009054906101000a900460ff16908060040160019054906101000a900460ff1690806005015490806006015490806007015490806008015490508a565b806007548110151561066b57610000565b6008600082815260200190815260200160002060040160009054906101000a900460ff161561069957610000565b6008600082815260200190815260200160002060040160019054906101000a900460ff16156106c757610000565b3373ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1614151561075057600254600660008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600001544203101561074f57610000565b5b6000600660008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206001015414156107a057610000565b600060086000848152602001908152602001600020600a0160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000154141561080457610000565b60086000838152602001908152602001600020600a0160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160009054906101000a900460ff16156108ec5760086000838152602001908152602001600020600a0160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600001546008600084815260200190815260200160002060060160008282540392505081905550610967565b60086000838152602001908152602001600020600a0160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000015460086000848152602001908152602001600020600701600082825403925050819055505b600860008381526020019081526020016000206008016000815480929190600190039190505550600660008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160008154809291906001900391905055506000600660008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600101541415610ada57600660008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600201546004600082825403925050819055506000600660008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020181905550600560008154809291906001900391905055505b5b5b505050565b60006008600083815260200190815260200160002060020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690505b919050565b61014060405190810160405280856000191681526020018481526020018373ffffffffffffffffffffffffffffffffffffffff1681526020018281526020016000151581526020016000151581526020016000815260200160008152602001600081526020016000815250600860006007548152602001908152602001600020600082015181600001906000191690556020820151816001019080519060200190610bce929190611780565b5060408201518160020160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506060820151816003015560808201518160040160006101000a81548160ff02191690831515021790555060a08201518160040160016101000a81548160ff02191690831515021790555060c0820151816005015560e08201518160060155610100820151816007015561012082015181600801559050506007600081548092919060010191905055505b50505050565b60006000600660008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600101541190505b919050565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515610d5257610000565b80600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b50565b60035481565b6000600860008381526020019081526020016000206003015490505b919050565b6000600860008381526020019081526020016000206000015490505b919050565b60075481565b60066020528060005260406000206000915090508060000154908060010154908060020154908060030154905084565b60045481565b600060006000600060008660075481101515610e3757610000565b6008600082815260200190815260200160002060040160009054906101000a900460ff1615610e6557610000565b6008600082815260200190815260200160002060040160019054906101000a900460ff1615610e9357610000565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663ac6c5251336000604051602001526040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050602060405180830381600087803b1515610f5557fe5b60325a03f11515610f6257fe5b5050506040518051905095506000861415610f7c57610000565b6000600660003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600101541415610fda576005600081548092919060010191905055505b600660003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020154945084860393506000841115611085578360046000828254019250508190555085600660003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600201819055505b60086000898152602001908152602001600020600a0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000154925060086000898152602001908152602001600020600a0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160009054906101000a900460ff16915060008311156112d1578615158215151415156111af5781156111895782600860008a8152602001908152602001600020600601600082825403925050819055506111ae565b82600860008a8152602001908152602001600020600701600082825403925050819055505b5b85600860008a8152602001908152602001600020600a0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000018190555086600860008a8152602001908152602001600020600a0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160006101000a81548160ff02191690831515021790555086156112a75785600860008a8152602001908152602001600020600601600082825401925050819055506112cc565b85600860008a8152602001908152602001600020600701600082825401925050819055505b6114e5565b87600660003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206004016000600660003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060030154815260200190815260200160002081905550600660003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060030160008154809291906001019190505550600860008981526020019081526020016000206008016000815480929190600101919050555085600860008a8152602001908152602001600020600a0160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000181905550861561146d5785600860008a815260200190815260200160002060060160008282540192505081905550611492565b85600860008a8152602001908152602001600020600701600082825401925050819055505b600660003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600101600081548092919060010191905055505b42600660003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600001819055505b5b5050505050505050565b6000600060006000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561159c57610000565b600860008681526020019081526020016000206000015493507f6f6e676f696e6700000000000000000000000000000000000000000000000000846000191614156115e657610000565b6064600354600454028115156115f857fe5b049250600860008681526020019081526020016000206006015491508282111561164c5760016008600087815260200190815260200160002060040160006101000a81548160ff0219169083151502179055505b600860008681526020019081526020016000206007015490508281111561169d5760016008600087815260200190815260200160002060040160016101000a81548160ff0219169083151502179055505b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16630a0155e5866000604051602001526040518263ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180828152602001915050602060405180830381600087803b151561173357fe5b60325a03f1151561174057fe5b50505060405180519050505b5b5050505050565b60055481565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106117c157805160ff19168380011785556117ef565b828001600101855582156117ef579182015b828111156117ee5782518255916020019190600101906117d3565b5b5090506117fc9190611800565b5090565b61182291905b8082111561181e576000816000905550600101611806565b5090565b905600a165627a7a72305820034aec8f14ea964b412b3b335f2ba154c4f685055eb42e5818f40af1887cc8040029'
        }
        
        var contract = web3.eth.contract(JSON.parse(congress.abi));
        var contractInstance = contract.new(
        $scope.congress.curator,
        {
            from: web3.eth.accounts[0],
            data: congress.bytecode
        }, 
        function (err, contract){
            console.log(contract);
            if (typeof contract.address !== 'undefined') {
                console.log('Congress Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
                $scope.medao.congress = contract.address;
                $scope.deployMeDao();
            } else {
                if(err)
                    console.error(err);
            }
        });
    };
    
    //Deploys a MeDao contract to the Ethereum blockchain
    $scope.deployMeDao = function(){
        var medao = {
            abi:'[{"constant":true,"inputs":[{"name":"_account","type":"address"}],"name":"isVetted","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"total_daos","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_meDao","type":"address"}],"name":"registerMeDao","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"index","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_newController","type":"address"}],"name":"changeController","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_ceo","type":"address"},{"name":"_vetted","type":"bool"}],"name":"vet","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_description_hash","type":"string"}],"name":"updateDescriptionHash","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"meDaos","outputs":[{"name":"owner","type":"address"},{"name":"meDao","type":"address"},{"name":"description_hash","type":"string"},{"name":"vetted","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_newMeDao","type":"address"}],"name":"updateMeDao","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"controller","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"}]',
            bytecode:'60606040525b33600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b610b7b806100576000396000f300606060405236156100a2576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806309c4a273146100a457806322c4efd8146100f25780632c8ab42914610118578063335932fc1461014e5780633cebb823146101ae5780637bbc33f0146101e4578063939a470e14610225578063a2f53a8a1461027f578063dc9861db146103bc578063f77c4791146103f2575bfe5b34156100ac57fe5b6100d8600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610444565b604051808215151515815260200191505060405180910390f35b34156100fa57fe5b61010261049e565b6040518082815260200191505060405180910390f35b341561012057fe5b61014c600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919050506104a4565b005b341561015657fe5b61016c6004808035906020019091905050610717565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34156101b657fe5b6101e2600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190505061074a565b005b34156101ec57fe5b610223600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803515159060200190919050506107ec565b005b341561022d57fe5b61027d600480803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919050506108a8565b005b341561028757fe5b6102b3600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610903565b604051808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200180602001831515151581526020018281038252848181546001816001161561010002031660029004815260200191508054600181600116156101000203166002900480156103aa5780601f1061037f576101008083540402835291602001916103aa565b820191906000526020600020905b81548152906001019060200180831161038d57829003601f168201915b50509550505050505060405180910390f35b34156103c457fe5b6103f0600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190505061097f565b005b34156103fa57fe5b610402610a04565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6000600360008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060030160009054906101000a900460ff1690505b919050565b60015481565b3373ffffffffffffffffffffffffffffffffffffffff16600360003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16141561053f57610000565b3360026000600154815260200190815260200160002060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506080604051908101604052803373ffffffffffffffffffffffffffffffffffffffff1681526020018273ffffffffffffffffffffffffffffffffffffffff1681526020016020604051908101604052806000815250815260200160001515815250600360003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008201518160000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060208201518160010160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060408201518160020190805190602001906106dd929190610a2a565b5060608201518160030160006101000a81548160ff0219169083151502179055509050506001600081548092919060010191905055505b50565b60026020528060005260406000206000915054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415156107a657610000565b80600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b50565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561084857610000565b80600360008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060030160006101000a81548160ff0219169083151502179055505b5b5050565b80600360003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020190805190602001906108fe929190610aaa565b505b50565b60036020528060005260406000206000915090508060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16908060010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169080600201908060030160009054906101000a900460ff16905084565b80600360003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b50565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10610a6b57805160ff1916838001178555610a99565b82800160010185558215610a99579182015b82811115610a98578251825591602001919060010190610a7d565b5b509050610aa69190610b2a565b5090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10610aeb57805160ff1916838001178555610b19565b82800160010185558215610b19579182015b82811115610b18578251825591602001919060010190610afd565b5b509050610b269190610b2a565b5090565b610b4c91905b80821115610b48576000816000905550600101610b30565b5090565b905600a165627a7a72305820b9da8dfc07172b6011b98b4d645658a1518df1993e763c80f9c7fae15a4947ec0029'
        }
        
        var contract = web3.eth.contract(JSON.parse(medao.abi));
        var contractInstance = contract.new(
        $scope.medao.ceo,
        $scope.medao.curator,
        $scope.medao.vault,
        $scope.medao.minimeToken,
        $scope.medao.congress,
        $scope.medao.maxTokenSupply,
        {
            from: web3.eth.accounts[0],
            data: medao.bytecode
        }, 
        function (err, contract){
            console.log(contract);
            if (typeof contract.address !== 'undefined') {
                console.log('MeDao Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
                
                Matriarch.registerMeDao(contract.address).then(
                function(txHash){
                    console.log('Me Dao Register txHash:',txHash);

                }).catch(function(err){
                    console.error('Me Dao Register failed', err);
                });
                
                MiniMeToken.setMMTAddress($scope.medao.minimeToken);
                MiniMeToken.changeController(contract.address).then(
                function(txHash){
                    console.log('Set MMT Controller txHash:',txHash);
                }).catch(function(err){
                    console.error('Set MMT Controller failed', err);
                });
                
                $scope.hidden = false;
                setup();
                
                Congress.setCongressAddress($scope.medao.congress);
                Congress.changeController(contract.address).then(
                function(txHash){
                    console.log('Set Congress Controller txHash:',txHash);
                }).catch(function(err){
                    console.error('Set Congress Controller failed', err);
                });
                
            } else {
                if(err)
                    console.error(err);
            }
        });
    };
    
    var setup = function(){
        
        MeDao.getCEO().then(
        function(ceo){
            $scope.ceo = ceo;
        });

        MeDao.getVault().then(
        function(vault){
            $scope.vault = vault;
        });

        MeDao.getCurator().then(
        function(curator){
            $scope.curator = curator;
        });

        MeDao.getMaxTokenSupply().then(
        function(max){
            $scope.maxTokenSupply = max;
        });

        MeDao.getTransferState().then(
        function(state){
            $scope.transfersAllowed = state;
        });

        setInterval(function(){
            MiniMeToken.getCurrentTokenSupply().then(
            function(supply){
                $scope.currentTokenSupply = supply;
            });

            MiniMeToken.getTokenBalance(Web3Service.getCurrentAccount())
            .then( function(balance){
                $scope.actions.sell.max = web3.fromWei(balance, 'ether').toNumber();
            }).catch( function(err){
                console.error(err);
            });

            Web3Service.getEtherBalance(Web3Service.getCurrentAccount())
            .then( function(etherBalance){
                $scope.actions.buy.max = web3.fromWei(etherBalance , 'ether').toNumber();
            }).catch( function(err){
                console.error(err);
            });
        }, 1000);


        $scope.actions = {
            buy: {
                token: 0,
                ico: 0,
                max: 0
            },
            sell: {
                token: 0,
                max: 0
            },
            transfer: {
                to: '',
                amount: 0
            },
            change: {
                newMMTaddress: $scope.currentMMTAddress
            }
        };

        $scope.currentAccount = Web3Service.getCurrentAccount();

        $scope.buyICOTokens = function(amount) {
            if($scope.maxTokenSupply <= $scope.currentTokenSupply)
                return false;

            var transactionObject = {from: Web3Service.getCurrentAccount(), 
                                     to: MiniMeToken.getMMTAddress(),
                                     value: web3.toWei(amount, 'ether'),
                                     gas: 300000};

            console.log(transactionObject);

            web3.eth.estimateGas(transactionObject, function(err, gas){
                console.log(err,gas); 
                transactionObject.gas = Math.round(gas*1.1);
                web3.eth.sendTransaction(transactionObject,
                function(err,address){
                    console.log(err,address);
                });
            });                               
        };

        $scope.transfer = function(to,amount) {
            console.log(to,amount);
            MiniMeToken.transfer(to,amount).then(
            function(txHash){
                console.log(txHash);
            }).catch(function(err){
                console.errror(err);
            });
        };

        MiniMeToken.getDecimals().then(
        function(decimals){
            $scope.decimals = decimals.toNumber();
        }).catch(function(err){
            console.error(err);
        });

        MiniMeToken.getSymbol(Web3Service.getCurrentAccount())
        .then( function(symbol){
            $scope.symbol = symbol;
        }).catch( function(err){
            console.error(err);
        });

        MiniMeToken.getName(Web3Service.getCurrentAccount())
        .then( function(name){
            $scope.name = name;
        }).catch( function(err){
            console.error(err);
        });

        $scope.MMTAddress = MiniMeToken.getMMTAddress();
    }
    
}]);